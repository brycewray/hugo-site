{{- $opts := dict "inlineImports" true -}}

{{- /*
	fingerprint everything even in dev,
	due to Safari caching weirdness
*/ -}}

{{- $css := resources.Get "css/index.css" -}}
{{- if hugo.IsProduction -}}
	{{- $css = $css | resources.Copy "css/index.min.css" -}}
	{{/* Lightning CSS is set in PostCSS config to minify only in production */}}
{{- end -}}
{{- $css = $css | postCSS $opts | fingerprint -}}
{{- with $css }}
	<link rel="preload" href="{{ $css.RelPermalink }}" as="style"{{- if hugo.IsProduction -}} integrity="{{ $css.Data.Integrity }}" crossorigin{{- end -}}>
	<link rel="stylesheet" href="{{ $css.RelPermalink }}" type="text/css" media="screen"{{- if hugo.IsProduction -}} integrity="{{ $css.Data.Integrity }}" crossorigin{{- end -}}>
{{- end }}

{{- /* for those who've requested CSS for printing */ -}}
{{- $printCSS := resources.Get "css/print.css" -}}
{{- if hugo.IsProduction -}}
	{{- $printCSS = $printCSS | resources.Copy "css/print.min.css" -}}
	{{/* Lightning CSS is set in PostCSS config to minify only in production */}}
{{- end -}}
{{- $printCSS = $printCSS | postCSS | fingerprint -}}
{{- with $printCSS -}}
	<link rel="stylesheet" href="{{ $printCSS.RelPermalink }}" type="text/css" media="print"{{- if hugo.IsProduction -}} integrity="{{ $printCSS.Data.Integrity }}"{{- end -}}>
{{- end }}
