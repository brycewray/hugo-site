{{- $opts := dict "inlineImports" true -}}
{{/* ^^ just in case, although probably n/a for scoped */}}
{{- $condition := "" -}}
{{- $fileName := "" -}}

{{- /*
	save some repetition below
*/ -}}
{{- $titleSitemap := .Site.Params.Titles.Sitemap -}}
{{- $titleHome := .Site.Params.Titles.Home -}}
{{- $titlePostslist := .Site.Params.Titles.Postslist -}}
{{- $titleFourOhFour := .Site.Params.Titles.FourOhFour -}}
{{- $titleSearch := .Site.Params.Titles.Search -}}

{{- $conditionSocial := false -}}
{{- $conditionCode := false -}}
{{- $conditionArtCode := false -}}
{{- $conditionTables := false -}}
{{- $conditionLiteYT := false -}}
{{- $conditionBillboard := false -}}
{{- $conditionArticle := false -}}
{{- $conditionPostsSingle := false -}}
{{- $conditionPostsList := false -}}
{{- $conditionFootnotes := false -}}
{{- $conditionHome := false -}}
{{- $conditionSitemap := false -}}
{{- $conditionSearchForm := false -}}
{{- $condition404 := false -}}
{{- if or (findRE `<blockquote class="toot-blockquote"` .Content 1) (findRE `<blockquote class="twitter-tweet"` .Content 1) -}}{{- $conditionSocial = true -}}{{- end -}}
{{- if (findRE `<div class="highlight"` .Content 1) -}}{{- $conditionCode = true -}}{{- end -}}
{{- if and (findRE `(<code)` .Content 1) (not (findRE `<div class="highlight"` .Content 1)) -}}{{- $conditionArtCode = true -}}{{- end -}}
{{- if (findRE `<table` .Content 1) -}}{{- $conditionTables = true -}}{{- end -}}
{{- if (findRE `<lite-youtube` .Content 1) -}}{{- $conditionLiteYT = true -}}{{- end -}}
{{- if (and (ne .Title $titleHome) (ne .Title $titleSitemap) (ne .Title $titlePostslist) (ne .Title $titleFourOhFour)) -}}{{- $conditionBillboard = true -}}{{- end -}}
{{- if (and (and (ne .Title $titleSearch) (ne .Title $titlePostslist)) (or (compare.Eq .Section "posts") (compare.Eq .Title .Site.Params.Titles.About) (compare.Eq .Title .Site.Params.Titles.Privacy) (compare.Eq .Title .Site.Params.Titles.Contact))) -}}{{- $conditionArticle = true -}}{{- end -}}
{{- if (and (compare.Eq .Section "posts") (ne .Title $titlePostslist)) -}}{{- $conditionPostsSingle = true -}}{{- end -}}
{{- if (compare.Eq .Title $titlePostslist) -}}{{- $conditionPostsList = true -}}{{- end -}}
{{- if (findRE `class="footnote-ref"` .Content 1) -}}{{- $conditionFootnotes = true -}}{{- end -}}
{{- if (compare.Eq .Title $titleHome) -}}{{- $conditionHome = true -}}{{- end -}}
{{- if (compare.Eq .Title $titleSitemap) -}}{{- $conditionSitemap = true -}}{{- end -}}
{{- if (compare.Eq .Title $titleSearch) -}}{{- $conditionSearchForm = true -}}{{- end -}}
{{- if (compare.Eq .Title $titleFourOhFour) -}}{{- $condition404 = true -}}{{- end -}}

{{- $cssTypes := collections.Slice -}}{{/* init big collections.Slice */}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionSocial "social-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionCode "code") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionArtCode "artcode") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionTables "tables-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionLiteYT "lite-yt-embed-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionBillboard "billboard-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionArticle "article-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionPostsSingle "posts-single-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionPostsList "posts-list-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionFootnotes "footnotes-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionHome "home-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionSitemap "sitemaphtml-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $conditionSearchForm "search-form-u") $cssTypes -}}
{{- $cssTypes = collections.Append collections.Slice (collections.Slice $condition404 "fourohfour-u") $cssTypes -}}

{{- range $cssTypes -}}
	{{- $condition = collections.Index . 0 -}}
	{{- $fileName = collections.Index . 1 -}}
	{{- if compare.Eq $condition true -}}
		{{- $css := resources.Get (print "css/" $fileName ".css") -}}
		{{- if hugo.IsProduction -}}
			{{- $css = $css | resources.Copy (print "css/" $fileName ".min.css") | postCSS | fingerprint -}}
		{{- end -}}
		{{- with $css -}}
			<link rel="preload" href="{{ $css.RelPermalink }}" as="style"{{- if hugo.IsProduction }} integrity="{{ $css.Data.Integrity }}" crossorigin{{- end -}}>
			<link rel="stylesheet" href="{{ $css.RelPermalink }}" type="text/css" media="screen"{{- if hugo.IsProduction }} integrity="{{ $css.Data.Integrity }}" crossorigin{{- end -}}>
		{{- end -}}
	{{ end -}}
{{- end }}

{{- /* for those who've requested CSS for printing */ -}}
{{- $printCSS := resources.Get "css/print.css" -}}
{{- if hugo.IsProduction -}}
	{{- $printCSS = $printCSS | resources.Copy "css/print.min.css" | postCSS | fingerprint -}}
{{- end -}}
{{- with $printCSS -}}
	<link rel="stylesheet" href="{{ $printCSS.RelPermalink }}" type="text/css" media="print"{{- if hugo.IsProduction }} integrity="{{ $printCSS.Data.Integrity }}"{{- end -}}>
{{- end }}
