{{- /*
	h/t to Joe Mooring's answer in
	https://discourse.gohugo.io/t/count-word-function-customized-to-exclude-code/34380
*/ -}}
{{- $wordsToCount := replaceRE `(?s)<div class="highlight">.*?</div>` "" .Content -}}
{{- $wordsToCount = replaceRE `(?s)<details.*?</details>` "" $wordsToCount -}}
{{- $wordCount := $wordsToCount | countwords -}}
{{- $readingTimeMinsInt := div (float $wordCount) 225 | math.Floor -}}
{{- $readingTime := div (float $wordCount) 225 -}}
{{- $readingTimeMins := $readingTime | math.Ceil -}}
{{- $readingTimeSecs := mul 60 (sub $readingTime $readingTimeMinsInt) | math.Ceil -}}
{{- if ge $readingTimeSecs 60 -}}
	{{- $readingTimeSecs = sub $readingTimeSecs 60 -}}
	{{- $readingTimeMinsInt = add $readingTimeMinsInt 1 -}}
{{- end -}}
{{- $readingTimeSecsInt := printf "%02v" $readingTimeSecs -}}
{{- $wordCountFmt := lang.FormatNumberCustom 0 $wordCount -}}
{{/* DRY-er... */}}
	{{- $titleSearch := site.Params.Titles.Search -}}
	{{- $titleContact := site.Params.Titles.Contact -}}
<div class="text-center relative h-auto px-6 pb-[1vh] md:px-12">
	<div class="block w-full pt-[1em]">
		<h1 class="my-0 mx-auto px-[2%] text-6xl pt-8 lg:pt-16 tracking-tighter">{{ .Title | .Page.RenderString }}</h1>
		{{- if and .Params.Description (ne .Title $titleSearch) }}
			<p class="text-2xl mx-auto px-[2%] tracking-tight pt-8">
				{{ .Description }}
			</p>
		{{- end }}
		{{- if (and (ne .Title $titleSearch) (ne .Title $titleContact) ) -}}
			<p class="text-[var(--head)] text-xl leading-5 mt-6 mb-2" data-pagefind-ignore>
				{{- if ne (substr .Title 0 22) "The site this week: 20" -}}<span class="pub-date">{{ .PublishDate.Format "2006-01-02" }}</span>{{- else -}}&nbsp;{{- end -}}
			</p>
			{{- if ne .Title $titleContact -}}
			<p class="text-xs" data-pagefind-ignore>
				Reading time: {{ $readingTimeMinsInt }}:{{ $readingTimeSecsInt }} &bull; {{ $wordCountFmt }} words
			</p>
			{{- end -}}
		{{- end }}
	</div>
</div>
