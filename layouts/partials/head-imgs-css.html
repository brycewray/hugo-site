{{- $cloudiBase := "https://res.cloudinary.com/brycewray-com/image/upload/" -}}
{{- $imgToGet := "" -}}
{{- $imgRsc := "" -}}
{{- $width := "" -}}
{{- $height := "" -}}

{{- with .Params.imgs }}
	<style media="screen">
	{{- range . -}}
		{{- $src := . -}}
		{{- $rscToMatch := fmt.Print "images/" $src -}}
		{{- $imgBd5 := crypto.MD5 . -}}
		{{- if resources.GetMatch $rscToMatch -}}
			{{- $imgRsc := resources.GetMatch $rscToMatch -}}
			{{- $BkgdStyleEnd := fmt.Print "; background-size: cover; background-repeat: no-repeat; aspect-ratio: " $imgRsc.Width " / " $imgRsc.Height ";" -}}
			{{- $GIP_colors := $imgRsc.Colors -}}
			{{- if (lt ($GIP_colors | len) 2) -}}
				{{- $GIP_colors = $GIP_colors | collections.Append "#000000" -}}
			{{- end -}}
			{{- $GIP_bkgd := collections.Delimit ($GIP_colors) ", " -}}
			{{- $BkgdStyleGIP := fmt.Print "background: linear-gradient(" $GIP_bkgd ")" $BkgdStyleEnd }}
			.imgB-{{ $imgBd5 }}-GIP {
				{{ $BkgdStyleGIP | safeCSS }}
			}
			{{- $LQIP_img := $imgRsc.Process "resize 20x jpg q20" -}}
			{{- $LQIP_b64 := $LQIP_img.Content | encoding.Base64Encode -}}
			{{- $BkgdStyleLQIP := fmt.Print "background: url(data:image/jpeg;base64," $LQIP_b64 ")" $BkgdStyleEnd }}
			.imgB-{{ $imgBd5 }}-LQIP {
				{{ $BkgdStyleLQIP | safeCSS }}
			}
		{{- else if (resources.GetRemote (print $cloudiBase $src)) -}}
			{{- $imgToGet = fmt.Print $cloudiBase $src -}}
			{{- with $imgToGet -}}
				{{- with resources.GetRemote . -}}
					{{- $imgRsc = . -}}
					{{- $imgRscDir := fmt.Print "images/remote/" $src  -}}
					{{- $imgRsc = $imgRsc.Content | resources.FromString $imgRscDir -}}
					{{- /* ^^^ https://discourse.gohugo.io/t/using-getremote-on-image-puts-the-resource-in-root/36397 */ -}}
					{{- $width = .Width -}}
					{{- $height = .Height -}}
					{{- $GIP_colors := .Colors -}}
					{{- $imgBd5 := crypto.MD5 $src -}}
					{{- $BkgdStyleEnd := fmt.Print "; background-size: cover; background-repeat: no-repeat; aspect-ratio: " $width " / " $height ";" -}}
					{{- if (lt ($GIP_colors | len) 2) -}}
						{{- $GIP_colors = $GIP_colors | collections.Append "#000000" -}}
					{{- end -}}
					{{- $GIP_bkgd := collections.Delimit ($GIP_colors) ", " -}}
					{{- $BkgdStyleGIP := fmt.Print "background: linear-gradient(" $GIP_bkgd ")" $BkgdStyleEnd -}}
					{{- $LQIP_img := $imgRsc.Process "resize 20x jpg q20" -}}
					{{- $LQIP_b64 := $LQIP_img.Content | encoding.Base64Encode -}}
					{{- $BkgdStyleLQIP := fmt.Print "background: url(data:image/jpeg;base64," $LQIP_b64 ")" $BkgdStyleEnd }}
					.imgB-{{ $imgBd5 }}-LQIP {
						{{ $BkgdStyleLQIP | safeCSS }}
					}
					.imgB-{{ $imgBd5 }}-GIP {
						{{ $BkgdStyleGIP | safeCSS }}
					}
				{{- end }}
			{{- end }}
		{{- end }}
	{{- end }}
	</style>
{{- end }}
