{{- $css := "" -}}
{{- $cssP := "" -}}
{{- $cssM := "" -}}
{{- $printCSS := "" -}}
{{- $scssOptions := dict "transpiler" "dartsass" -}}
{{- $scssComp := dict "outputStyle" "compressed" -}}
{{- $scssOptionsComp := merge $scssComp (dict "targetPath" "index.min.css") -}}
{{- $scssOptionsPrint := $scssOptions -}}
{{- $scssOptionsPrintComp := merge $scssComp (dict "targetPath" "print.min.css") -}}
{{- $Styling := .Site.Params.Styling -}}

{{- if eq $Styling "SCSS" -}}
	{{- if hugo.IsProduction -}}
		{{- $scssOptions = merge $scssOptions $scssOptionsComp -}}
		{{- $css = resources.Get "scss/index.scss" | toCSS $scssOptions | fingerprint -}}
	{{- else -}}
		{{- $css = resources.Get "scss/index.scss" | toCSS $scssOptions -}}
	{{- end -}}
{{- end -}}
{{- if eq $Styling "VCSS" -}}
	{{- $cssP = resources.Match "css/partials/*.css" | resources.Concat "css/partials.css" -}}
	{{- $cssM = resources.Match "css/*.css" | resources.Concat "css/main.css" -}}
	{{- if hugo.IsProduction -}}
		{{- $css = slice $cssP $cssM | resources.Concat "css/index.css" | minify | fingerprint -}}
	{{- else -}}
		{{- $css = slice $cssP $cssM | resources.Concat "css/index.css" -}}
	{{- end -}}
{{- end -}}
{{- if ne $css "" }}
	{{- /*
	<link rel="preload" as="font" href="/fonts/LibreFranklin-Roman-VariableFont_subset.woff2" type="font/woff2" crossorigin>
	<link rel="preload" as="font" href="/fonts/LibreFranklin-Italic-VariableFont_subset.woff2" type="font/woff2" crossorigin>
	*/ -}}
	{{/*  <style media="screen">{{ .Content | safeCSS }}</style>  */}}
	<link rel="preload" href="{{ $css.RelPermalink }}" as="style"{{- if hugo.IsProduction -}} integrity="{{ $css.Data.Integrity }}" crossorigin{{- end -}}>
	<link rel="stylesheet" href="{{ $css.RelPermalink }}" type="text/css" media="screen"{{- if hugo.IsProduction -}} integrity="{{ $css.Data.Integrity }}" crossorigin{{- end -}}>
{{- end }}

{{- /* for those who've requested CSS for printing */ -}}
{{- if eq $Styling "SCSS" -}}
	{{- if hugo.IsProduction -}}
		{{- $scssOptionsPrint := merge $scssOptionsPrint $scssOptionsPrintComp -}}
		{{- $printCSS = resources.Get "scss/print/print.scss" | toCSS $scssOptionsPrint | fingerprint -}}
	{{- else -}}
		{{- $printCSS = resources.Get "scss/print/print.scss" | toCSS $scssOptionsPrint -}}
	{{- end -}}
{{- end -}}
{{- if eq $Styling "VCSS" -}}
	{{- if hugo.IsProduction -}}
		{{- $printCSS = resources.Get "css/print/print.css" | minify | fingerprint -}}
	{{- else -}}
		{{- $printCSS = resources.Get "css/print/print.css" -}}
	{{- end -}}
{{- end -}}
{{- if ne $printCSS "" -}}
	<link rel="stylesheet" href="{{ $printCSS.RelPermalink }}" type="text/css" media="print"{{- if hugo.IsProduction -}} integrity="{{ $printCSS.Data.Integrity }}"{{- end -}}>
{{- end }}
